<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Potlapalli Farms - Fresh & Organic Produce Delivered</title>
    <meta name="description" content="Experience the taste of freshness. Potlapalli Farms deliver premium, organic goat meat, country chicken, and farm-fresh eggs directly to your doorstep." />
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

    <style>
        /* --- 1. Foundational Styles & Variables --- */
        :root {
            --primary-color: #27ae60;
            --primary-color-dark: #1e874b;
            --secondary-color: #2c3e50;
            --background-light: #f8f9fa;
            --text-dark: #333;
            --text-light: #555;
            --white: #fff;
            --border-light: #e0e0e0;
            --shadow-light: rgba(0,0,0,0.08);
            --shadow-dark: rgba(0,0,0,0.12);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        html { scroll-behavior: smooth; }
        body { background-color: var(--white); color: var(--text-dark); line-height: 1.6; }
        .container { width: 90%; max-width: 1200px; margin: 0 auto; }
        img { max-width: 100%; display: block; }
        a, button { transition: all 0.3s ease; }

        /* --- 2. Header & Navigation (FINAL ALIGNMENT & COLOR FIX) New --- */
        .header {
    position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; padding: 1rem 0;
    
    /* Apply transparent background and blur from the start */
    background-color: rgba(255, 255, 255, 0.2); /* Very light transparency */
    -webkit-backdrop-filter: blur(5px); /* Starting blur */
    backdrop-filter: blur(5px); /* Starting blur */
    
    transition: background-color 0.4s ease, box-shadow 0.4s ease, padding 0.4s ease, backdrop-filter 0.4s ease;
}
        .header.scrolled {
    /* More opaque and more blurry on scroll */
    background-color: rgba(255, 255, 255, 0.8); 
    box-shadow: 0 4px 20px rgba(0,0,0,0.07);
    padding: 0.75rem 0;
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
}
        .header-inner { display: flex; justify-content: space-between; align-items: center; }
        
        /* Logo & Text - Default (Unscrolled) is WHITE */
        .logo a { display: flex; align-items: center; gap: 0.75rem; font-size: 1.4rem; font-weight: 700; color: var(--white); text-decoration: none; text-shadow: 0 1px 3px rgba(0,0,0,0.3); }
        .logo img { height: 40px; }
        /* ADD THIS NEW RULE */
.logo span {
    white-space: nowrap;
}

        /* HEADER ACTIONS: Container for Nav, Cart, and Auth buttons */
        .header-actions { display: flex; align-items: center; gap: 20px; }
        
        /* Desktop Navigation Links Container */
        #desktop-nav { 
            display: flex; 
            align-items: center;
            gap: 20px; /* Spacing between Cart/Auth and the Nav links */
            margin-right: 20px; /* Push nav slightly away from actions group */
        }
        
        /* Desktop Navigation Links Text */
        #desktop-nav a { 
            font-weight: 500; 
            text-decoration: none; 
            padding: 0.5rem 0; 
            position: relative; 
            color: var(--white); /* Default (Unscrolled) is White */
            transition: color 0.3s;
        }

        /* SCROLLED STATE: Change everything to secondary-color (DARK) */
        .header.scrolled .logo a, 
        .header.scrolled #desktop-nav a, 
        .header.scrolled .menu-btn,
        .header.scrolled .mini-cart a,
        .header.scrolled .auth-btn { 
            color: var(--secondary-color) !important; 
            text-shadow: none; 
        }
        .header.scrolled .mini-cart span { background-color: var(--primary-color); color: var(--white); }

        /* AUTH BUTTON STYLING */
        .auth-btn { font-weight: 600; text-decoration: none; font-size: 0.95rem; color: var(--white); }
        .mini-cart a { font-size: 1.2rem; text-decoration: none; position: relative; color: var(--white); }
        .mini-cart span { position: absolute; top: -8px; right: -10px; background-color: var(--primary-color); color: var(--white); font-size: 0.7rem; font-weight: 600; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; }
        
        .menu-btn { display: none; background: none; border: none; font-size: 1.8rem; cursor: pointer; z-index: 1001; color: var(--white); }

        /* --- MOBILE MENU HANDLING (The slide-out) --- */
        .nav-links { 
            /* Base styles for the slide-out menu */
            position: fixed; top: 0; right: 0; width: 100%; height: 100vh;
            background-color: var(--white); 
            z-index: 999; 
            flex-direction: column; align-items: center; justify-content: center; gap: 2.5rem;
            transform: translateX(100%);
            transition: transform 0.5s cubic-bezier(0.77, 0, 0.175, 1);
            list-style: none; padding: 0;
            display: none; 
        }
        .nav-links.active { display: flex; transform: translateX(0); }
        .nav-links a { font-size: 1.8rem; font-weight: 600; color: var(--secondary-color); }
        
        /* --- 8. Responsive Design --- */
        @media (max-width: 992px) {
            #desktop-nav { display: none !important; } /* Hide the inline desktop links */
            .header-actions { margin-right: 0; gap: 15px; }
            .menu-btn { display: block !important; } /* Show hamburger icon */
        }
        /* --- 3. Hero Slider --- */
        .hero { position: relative; height: 100vh; color: var(--white); overflow: hidden; }
        .hero-slider { display: flex; height: 100%; transition: transform 0.8s cubic-bezier(0.77, 0, 0.175, 1); }
        .hero-slide { min-width: 100%; height: 100%; position: relative; display: flex; align-items: center; justify-content: center; text-align: center; padding: 1rem; }
        .hero-slide::before { content: ''; position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0.3)); }
        .hero-slide img { position: absolute; width: 100%; height: 100%; object-fit: cover; z-index: -1; }
        .hero-content { position: relative; z-index: 2; max-width: 800px; animation: fadeIn 1s 0.5s forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        .hero-content h1 { font-family: 'Playfair Display', serif; font-size: clamp(2.8rem, 6vw, 4.5rem); margin-bottom: 1rem; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .hero-content p { font-size: clamp(1.1rem, 2.5vw, 1.3rem); margin-bottom: 2.5rem; }
        .hero-btn { display: inline-block; background: var(--primary-color); padding: 1rem 3rem; font-size: 1.1rem; font-weight: 600; border-radius: 50px; text-decoration: none; color: var(--white); }
        .hero-btn:hover { background: var(--primary-color-dark); transform: scale(1.05); }
        .slider-nav { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 3; display: flex; gap: 12px; }
        .slider-dot { width: 12px; height: 12px; background: rgba(255,255,255,0.5); border-radius: 50%; cursor: pointer; }
        .slider-dot.active { background: var(--white); transform: scale(1.2); }

        /* --- 4. General Section Styling --- */
        .section { padding: 6rem 0; }
        .section-header { text-align: center; margin-bottom: 4rem; }
        .section-header h2 { font-family: 'Playfair Display', serif; font-size: clamp(2.2rem, 4vw, 3rem); color: var(--secondary-color); margin-bottom: 0.75rem; }
        .section-header p { font-size: 1.1rem; color: var(--text-light); max-width: 600px; margin: 0 auto; }
        .animated-section { opacity: 0; transform: translateY(40px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; }
        .animated-section.visible { opacity: 1; transform: translateY(0); }

        /* --- 5. Products Grid --- */
        .features-grid, .product-grid, .how-it-works-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2.5rem; }
        #why-choose-us { background: var(--background-light); }
        .feature-card, .step-card { text-align: center; }
        .feature-card .icon, .step-card .icon { font-size: 3rem; color: var(--primary-color); margin-bottom: 1.5rem; }
        .feature-card h3, .step-card h3 { font-size: 1.4rem; margin-bottom: 0.5rem; color: var(--secondary-color); }

        .product-card { background: var(--white); border-radius: 16px; box-shadow: 0 8px 30px var(--shadow-light); overflow: hidden; display: flex; flex-direction: column; transform: translateY(0); transition: transform 0.4s ease, box-shadow 0.4s ease; }
        .product-card:hover { transform: translateY(-10px); box-shadow: 0 12px 35px var(--shadow-dark); }
        .product-card img { width: 100%; aspect-ratio: 4/3; object-fit: cover; }
        .product-content { padding: 1.5rem; display: flex; flex-direction: column; flex-grow: 1; }
        .product-content h3 { font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--secondary-color); }
        .product-content p { color: var(--text-light); flex-grow: 1; margin-bottom: 1.5rem; font-size: 0.95rem; }
        .price-line { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.2rem; }
        .price { font-weight: 700; font-size: 1.4rem; color: var(--secondary-color); }
        .price small { font-size: 0.9rem; font-weight: 500; color: var(--text-light); }
        .quantity-controls { display: flex; align-items: center; gap: 1rem; }
        .qty-btn { width: 32px; height: 32px; border-radius: 50%; border: 1px solid var(--border-light); background-color: var(--background-light); cursor: pointer; font-size: 1.3rem; color: var(--secondary-color); }
        .qty-btn:hover { background-color: #e9ecef; }
        .qty { font-weight: 600; font-size: 1.2rem; }
        .unit-text { font-size: 0.9rem; color: var(--text-light); } 

        .add-to-cart-btn { background: var(--primary-color); color: var(--white); border: none; padding: 0.9rem 1.5rem; border-radius: 50px; cursor: pointer; font-weight: 600; width: 100%; font-size: 1rem; }
        .add-to-cart-btn:hover { background: var(--primary-color-dark); }
        
        /* Contact Button for Live Products */
        .contact-btn { background: var(--secondary-color); }
        .contact-btn:hover { background: #34495e; }
        
        /* Upcoming Products Section Styling */
        #upcoming-products-section { padding: 4rem 0; background-color: var(--background-light); }
        .upcoming-list { list-style: none; padding: 0; display: flex; flex-wrap: wrap; justify-content: center; gap: 1.5rem; margin-top: 2rem; }
        .upcoming-list li { background: var(--white); padding: 0.8rem 1.5rem; border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); font-weight: 600; color: var(--secondary-color); }
        .upcoming-list li i { color: var(--primary-color); margin-right: 0.5rem; }

        /* --- 6. Testimonials & Footer --- */
        #testimonials { background: var(--secondary-color); color: var(--white); }
        #testimonials .section-header h2, #testimonials .section-header p { color: var(--white); }
        .testimonial-card { background: rgba(255,255,255,0.1); padding: 2.5rem; border-radius: 12px; max-width: 800px; margin: 0 auto; text-align: center; }
        .testimonial-card p { font-style: italic; margin-bottom: 1.5rem; font-size: 1.2rem; line-height: 1.7; }
        .testimonial-author { font-weight: 600; font-size: 1rem; }
        #how-it-works { background-color: var(--background-light); }
        footer { background: #1e293b; color: #cbd5e1; padding: 5rem 0 2rem; }
        .footer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 3rem; }
        .footer-col h4 { font-size: 1.3rem; margin-bottom: 1.5rem; color: var(--white); }
        .footer-col p, .footer-col a { color: #94a3b8; text-decoration: none; }
        .footer-col a { display: block; margin-bottom: 0.75rem; }
        .footer-col a:hover { color: var(--white); padding-left: 5px; }
        .footer-bottom { text-align: center; margin-top: 4rem; padding-top: 2rem; border-top: 1px solid #334155; font-size: 0.9rem; color: #94a3b8; }

        /* --- 7. Utilities & Toast --- */
        .toast { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background-color: var(--secondary-color); color: var(--white); padding: 1rem 1.5rem; border-radius: 50px; z-index: 2000; transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
        .toast.show { bottom: 20px; }
        body.nav-open { overflow: hidden; }

        /* --- 8. Responsive Design (MOBILE MENU FIX) --- */
        @media (max-width: 992px) {
            .header-nav { display: none !important; } /* Ensure desktop navigation is hidden */
            .menu-btn { display: block; z-index: 1001; } /* Ensure hamburger is shown */
            
            .nav-links {
                position: fixed; top: 0; right: 0; width: 100%; height: 100vh;
                background-color: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
                z-index: 999; 
                flex-direction: column; align-items: center; justify-content: center; gap: 2.5rem;
                transform: translateX(100%);
                transition: transform 0.5s cubic-bezier(0.77, 0, 0.175, 1);
                /* Ensure mobile menu list is flexed */
                display: flex !important;
            }

            .nav-links.active {
                transform: translateX(0); 
            }

            .nav-links a { font-size: 1.8rem; font-weight: 600; color: var(--secondary-color); }
        }
    </style>
</head>
<body>
    <header class="header" id="header">
    <div class="container header-inner">
        <div class="logo">
            <a href="index.html">
                <img src="assets/logo.png" alt="Potlapalli Farms Logo"/>
                <span>Potlapalli Farms</span>
            </a>
        </div>
        
        <!-- Desktop Nav Links - This is the PRIMARY navigation for desktop view -->
        <nav class="header-nav" id="desktop-nav"> 
            <a href="#home">Home</a>
            <a href="#products">Products</a>
            <a href="about.html">About</a>
            <a href="#contact">Contact</a>
        </nav>

        <div class="header-actions">
            <div class="mini-cart">
                <a href="cart.html" aria-label="View shopping cart">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cartCount">0</span>
                </a>
            </div>
            <!-- Dynamic Auth Controls container (Desktop) -->
            <div id="auth-controls" class="auth-controls">
                <!-- Log In / My Profile / Log Out inserted here by JS -->
            </div>
            <!-- Hamburger Menu Button -->
            <button class="menu-btn" id="menuBtn" aria-label="Toggle navigation menu">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </div>
</header>
                    <ul class="nav-links">
                        <li><a href="#home">Home</a></li>
                        <li><a href="#products">Products</a></li>
                        <li><a href="about.html">About</a></li>
                        <li><a href="#contact">Contact</a></li>
                    </ul>
                </nav>
                <div class="mini-cart">
                    <a href="cart.html" aria-label="View shopping cart">
                        <i class="fas fa-shopping-cart"></i>
                        <span id="cartCount">0</span>
                    </a>
                </div>
                <div id="auth-controls" class="auth-controls">
                    </div>
                <button class="menu-btn" id="menuBtn" aria-label="Toggle navigation menu">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>
    
    <ul class="nav-links" id="nav-links">
        <li><a href="#home">Home</a></li>
        <li><a href="#products">Products</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="#contact">Contact</a></li>
        <div id="mobile-auth-links">
            </div>
    </ul>

    <main>
        <section class="hero" id="home">
            <div class="hero-slider">
                <div class="hero-slide active"><img src="assets/images/shopnow.jpeg" alt="Lush green farm fields"><div class="hero-content"><h1>Farm Freshness, Delivered.</h1><p>The best of nature, from our farm to your family.</p><a href="#products" class="hero-btn">Shop Now</a></div></div>
                <div class="hero-slide"><img src="assets/images/hero.jpg" alt="Organic Goodness"><div class="hero-content"><h1>Pure, Organic Goodness</h1><p>No chemicals, no compromises. Just honest, healthy food.</p><a href="about.html" class="hero-btn">Our Story</a></div></div>
            </div>
            <div class="slider-nav"></div>
        </section>

        <section id="why-choose-us" class="section animated-section">
            <div class="container">
                <div class="section-header"><h2>Why Potlapalli Farms?</h2></div>
                <div class="features-grid">
                    <div class="feature-card"><div class="icon"><i class="fas fa-leaf"></i></div><h3>100% Organic</h3><p>Grown naturally without any harmful pesticides or chemicals.</p></div>
                    <div class="feature-card"><div class="icon"><i class="fas fa-truck"></i></div><h3>Directly From Farm</h3><p>We harvest, pack, and deliver, ensuring maximum freshness.</p></div>
                    <div class="feature-card"><div class="icon"><i class="fas fa-heart"></i></div><h3>Ethically Raised</h3><p>Our animals are free-range, grass-fed, and treated with care.</p></div>
                    <div class="feature-card"><div class="icon"><i class="fas fa-shield-alt"></i></div><h3>Quality Assured</h3><p>Hygienically packed to preserve nutrition and taste.</p></div>
                </div>
            </div>
        </section>

        <section class="section" id="products">
            <div class="container">
                <div class="section-header"><h2>Our Fresh Produce</h2><p>Handpicked and curated with care, from our fields to your plate.</p></div>
                <div class="product-grid" id="product-grid"></div>
            </div>
        </section>
        
        <section id="upcoming-products-section" class="section animated-section">
            <div class="container">
            </div>
        </section>

        <section id="how-it-works" class="section animated-section" style="background-color: var(--background-light);">
            <div class="container">
                <div class="section-header"><h2>How It Works</h2></div>
                <div class="how-it-works-grid">
                    <div class="step-card"><div class="icon"><i class="fas fa-mouse-pointer"></i></div><h3>1. You Order Online</h3><p>Browse our fresh selection and place your order with a few clicks.</p></div>
                    <div class="step-card"><div class="icon"><i class="fas fa-tractor"></i></div><h3>2. We Harvest & Pack</h3><p>We harvest your produce fresh from the farm only after you order.</p></div>
                    <div class="step-card"><div class="icon"><i class="fas fa-shipping-fast"></i></div><h3>3. We Deliver Fresh</h3><p>Your order is delivered to your doorstep, ensuring peak freshness.</p></div>
                </div>
            </div>
        </section>
        
        <section id="testimonials" class="section animated-section">
            <div class="container">
                 <div class="section-header"><h2>What Our Customers Say</h2></div>
                 <div class="testimonial-card">
                        <p>"The best goat meat I've had in years! The freshness is unparalleled. You can truly taste the difference. Highly recommended!"</p>
                        <div class="testimonial-author">- Priya S, Hyderabad</div>
                 </div>
            </div>
        </section>
    </main>

    <footer id="contact">
        <div class="container">
             <div class="footer-grid">
                <div class="footer-col"><h4>About Us</h4><p>Potlapalli Farms is dedicated to bringing you the freshest, most ethical, and organic produce. A legacy of trust, from our family to yours.</p></div>
                <div class="footer-col"><h4>Quick Links</h4><a href="#home">Home</a><a href="#products">Products</a><a href="about.html">About</a></div>
                <div class="footer-col"><h4>Contact</h4><p>Potlapalli Village, AP<br>Email: contact@potlapallifarm.com<br>Phone: +91 98765 43210</p></div>
                <div class="footer-col"><h4>Follow Us</h4><a href="#">Facebook</a><a href="#">Instagram</a></div>
             </div>
             <div class="footer-bottom"><p>© 2025 Potlapalli Farms. All Rights Reserved.</p></div>
        </div>
    </footer>
    
    <div id="toast" class="toast" aria-live="polite"></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const menuBtn = document.getElementById('menuBtn');
        const navLinks = document.getElementById('nav-links');
        
        if (menuBtn && navLinks) {
            const menuIcon = menuBtn.querySelector('i');

            menuBtn.addEventListener('click', () => {
                // Toggle the 'active' class to show/hide the menu
                navLinks.classList.toggle('active');

                // Bonus: This changes the icon from bars to an 'X'
                if (navLinks.classList.contains('active')) {
                    menuIcon.classList.remove('fa-bars');
                    menuIcon.classList.add('fa-times');
                } else {
                    menuIcon.classList.remove('fa-times');
                    menuIcon.classList.add('fa-bars');
                }
            });
        }
    });
</script>
    
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    // Initialize Firebase app instance (using your consistent config):
    const firebaseConfig = {
        apiKey: "AIzaSyAXmkk4DfFahS9euqh-xR7uS3JpRS0Ll0c",
        authDomain: "potlapallifarm.firebaseapp.com",
        projectId: "potlapallifarm",
        storageBucket: "potlapallifarm.firebasestorage.app",
        messagingSenderId: "1017629729159",
        appId: "1:1017629729159:web:357c420a9de335d427b322",
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);


    // --- 1. State & Data (Updated Product List) ---
    const products = [
        // Live Products (isLive: true - Contact to Order)
        { id: 'live-ram', name: 'Live Ram (Macherla Pottelu)', price: 450, unit: '/kg', category: 'Live Meat', isMeat: true, isLive: true, description: 'Live Ram, range 15 to 40 kg.', image: 'assets/ram.jpg' },
        { id: 'buck', name: 'Buck (Meka Pothu)', price: 450, unit: '/kg', category: 'Live Meat', isMeat: true, isLive: true, description: 'Live Buck, range 15 to 40 kg.', image: 'assets/images/buck.jpg' },
        { id: 'live-natu-kodi', name: 'Live Natu Kodi (Country Chicken)', price: 700, unit: '/kg', category: 'Live Birds', isMeat: false, isLive: true, description: 'Fresh, live country chicken, delivered to your specifications.', image: 'assets/live-natu-kodi.jpg' }, // NEW PRODUCT

        // Processed Meats (isMeat: true - 0.25kg increments)
        { id: 'sonali-chicken', name: 'Sonali Country Chicken (Smokey Turmeric)', price: 550, unit: '/kg', category: 'Meat', isMeat: true, description: 'Premium Sonali country chicken.', image: 'assets/sonali.jpg' },
        { id: 'backyard-chicken', name: 'Backyard Country Chicken (Smokey Turmeric)', price: 800, unit: '/kg', category: 'Meat', isMeat: true, description: 'High-quality backyard country chicken.', image: 'assets/images/backyard.jpg' },
        { id: 'goat', name: 'Premium Goat Meat (Flesh)', price: 900, unit: '/kg', category: 'Meat', isMeat: true, description: 'Tender, pasture-raised goat meat.', image: 'assets/images/goat.jpg' },
        
        // Other Products
        { id: 'eggs-dozen', name: 'Country Chicken Eggs', price: 180, unit: '/dozen', category: 'Eggs', isMeat: false, description: 'A dozen golden-yolk eggs.', image: 'assets/images/eggs.jpg' },
        { id: 'eggs-tray', name: '30 Eggs Tray', price: 430, unit: '/tray', category: 'Eggs', isMeat: false, description: 'Tray of 30 golden-yolk eggs.', image: 'assets/images/tray.jpg' },
        { id: 'milk', name: 'Fresh Goat Milk', price: 60, unit: '/L', category: 'Dairy', isMeat: false, description: 'Nutritious and easy-to-digest fresh goat milk.', image: 'assets/images/milk.jpg' }
    ];
    
    // --- Upcoming Products Section Data ---
    const upcomingProducts = [
        'Fish', 'Prawns', 'Crabs', 'Buffalo Milk', 'Cow Milk', 'Button Mushrooms'
    ];

    const CART_KEY = 'potlapalliCart';

    // --- 2. DOM Elements (Including Auth Controls) ---
    const productGrid = document.getElementById('product-grid');
    const cartCountEl = document.getElementById('cartCount');
    const upcomingProductsSection = document.getElementById('upcoming-products-section');
    const toastEl = document.getElementById('toast');
    const header = document.getElementById('header');
    const menuBtn = document.getElementById("menuBtn");
    const navLinks = document.getElementById("nav-links");
    const authControls = document.getElementById('auth-controls');
    const mobileAuthLinks = document.getElementById('mobile-auth-links');


    // --- 3. Cart & Utility Functionality ---
    const showToast = (message, isError = false) => {
        toastEl.textContent = message;
        toastEl.classList.add(isError ? 'error' : 'show');
        setTimeout(() => toastEl.classList.remove('show', 'error'), 3000);
    };

    const updateCartCount = () => {
        const cart = JSON.parse(localStorage.getItem(CART_KEY)) || [];
        // FIX: Cart count should reflect the number of unique items/product types
        const totalItems = cart.length; 
        if (cartCountEl) cartCountEl.textContent = totalItems;
    };

    const handleAddToCart = (productId, quantity, cardElement) => {
        if (quantity <= 0) {
             showToast('Quantity must be more than the minimum order size.', true);
             return;
        }
        const product = products.find(p => p.id === productId);
        if (!product) return;

        let cart = JSON.parse(localStorage.getItem(CART_KEY)) || [];
        const existingItem = cart.find(item => item.id === productId);

        if (existingItem) {
            existingItem.quantity += quantity;
        } else {
            cart.push({ ...product, quantity: quantity });
        }
        localStorage.setItem(CART_KEY, JSON.stringify(cart));
        
        updateCartCount();
        showToast(`${quantity.toFixed(product.isMeat ? 2 : 0)}${product.isMeat ? 'kg' : product.unit.replace('/', '')} of ${product.name} added to cart!`);
        
        if (cardElement) {
             const isGoat = product.id === 'goat';
             const resetQty = isGoat ? 0.75 : (product.isMeat ? 0.5 : 1);
             cardElement.querySelector('.qty').textContent = resetQty.toFixed(product.isMeat ? 2 : 0);
             updatePriceDisplay(cardElement, product);
        }
    };
    
    // --- Dynamic Price Display ---
    const updatePriceDisplay = (cardElement, product) => {
        const qtyEl = cardElement.querySelector('.qty');
        const priceDisplayEl = cardElement.querySelector('.price-display');
        const pricePerUnitSmallEl = cardElement.querySelector('.price-per-unit-small');

        const currentQty = parseFloat(qtyEl.textContent);
        const basePrice = product.price;

        let calculatedPrice = basePrice * currentQty;
        
        priceDisplayEl.textContent = `₹${calculatedPrice.toFixed(0)}`;
        
        let unitTextContent = `(₹${basePrice}${product.unit})`;
        pricePerUnitSmallEl.innerHTML = unitTextContent;
    };
    
    // --- 4. Product Rendering ---
    const renderProducts = () => {
        if (!productGrid) return;
        
        productGrid.innerHTML = products.map(product => {
            const isGoat = product.id === 'goat';
            const initialQty = isGoat ? 0.75 : (product.isMeat ? 0.5 : 1);
            const unitText = product.isMeat ? 'kg' : product.unit.replace('/', '');
            const initialPrice = product.price * initialQty;
            
            // Check if product is live (needs Contact button)
            if (product.isLive) {
                return `
                    <div class="product-card animated-section" data-id="${product.id}">
                        <img src="assets/images/${product.id}.jpg" alt="${product.name}">
                        <div class="product-content">
                            <h3>${product.name}</h3>
                            <p>${product.description} <span class="price-per-unit-small">(₹${product.price}/kg Live Weight)</span></p>
                            <div class="product-footer">
                                <span class="price price-display">₹${product.price}/kg</span>
                                <a href="#contact" class="add-to-cart-btn contact-btn">Contact to Order</a>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Standard E-commerce Product (Meat and Others)
            return `
                <div class="product-card animated-section" data-id="${product.id}">
                    <img src="assets/images/${product.id}.jpg" alt="${product.name}">
                    <div class="product-content">
                        <h3>${product.name}</h3>
                        <p>${product.description} <span class="price-per-unit-small">(₹${product.price}${product.unit})</span></p>
                        <div class="product-footer">
                            <div class="price-line">
                                <span class="price price-display">₹${initialPrice.toFixed(0)}</span>
                                <div class="quantity-controls">
                                    <button class="qty-btn minus-btn" aria-label="Decrease quantity">-</button>
                                    <span class="qty">${initialQty.toFixed(product.isMeat ? 2 : 0)}</span>
                                    <button class="qty-btn plus-btn" aria-label="Increase quantity">+</button>
                                    <small class="unit-text">${unitText}</small>
                                </div>
                            </div>
                            <button class="add-to-cart-btn">Add to Cart</button>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
        
        renderUpcomingProducts();
    };
    
    // --- 4b. Render Upcoming Products ---
    const renderUpcomingProducts = () => {
        const container = document.querySelector('#upcoming-products-section .container');
        if (!container) return; 

        container.innerHTML = `
            <div class="section-header"><h2><i class="fas fa-seedling"></i> Coming Soon</h2><p>We are expanding our range with more fresh, high-quality organic items!</p></div>
            <ul class="upcoming-list">
                ${upcomingProducts.map(item => `<li><i class="fas fa-check"></i> ${item}</li>`).join('')}
            </ul>
        `;
    };

    // --- 4.5. Authentication Status Manager (HEADER FIX) ---

    const renderAuthControls = (user) => {
        // Clear mobile auth links first
        mobileAuthLinks.innerHTML = '';

        if (user) {
            // Logged In State
            
            // Desktop: Show My Profile and Log Out buttons
            authControls.innerHTML = `
                <a href="profile.html" class="auth-btn">My Profile</a>
                <button class="auth-btn" id="signOutBtn" style="border:none; background:none; color: var(--primary-color); cursor:pointer;">Log Out</button>
            `;
            document.getElementById('signOutBtn').addEventListener('click', handleLogout);

            // Mobile Menu: Only Profile and Logout
            navLinks.innerHTML = `
                <li><a href="#home">Home</a></li>
                <li><a href="#products">Products</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="#contact">Contact</a></li>
                <div id="mobile-auth-links">
                    <li><a href="profile.html" class="auth-btn">My Profile</a></li>
                    <li><a href="#" id="signOutBtnMobile" class="auth-btn">Log Out</a></li>
                </div>
            `;
            document.getElementById('signOutBtnMobile').addEventListener('click', handleLogout);

        } else {
            // Logged Out State
            
            // Desktop: Show Log In button
            authControls.innerHTML = `<a href="signin.html" class="auth-btn">Log In</a>`;

            // Mobile Menu: Show Log In and Sign Up
            navLinks.innerHTML = `
                <li><a href="#home">Home</a></li>
                <li><a href="#products">Products</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="#contact">Contact</a></li>
                <div id="mobile-auth-links">
                    <li><a href="signin.html" class="auth-btn">Log In</a></li>
                    <li><a href="signup.html" class="auth-btn">Sign Up</a></li>
                </div>
            `;
        }
    };

    const handleLogout = () => {
        signOut(auth).then(() => {
            showToast("Signed out successfully!");
            renderAuthControls(null); // Update UI
        }).catch(error => {
            showToast("Logout error.", true);
            console.error("Logout failed:", error);
        });
    };

    // Listen for authentication state changes and update the header buttons
    onAuthStateChanged(auth, renderAuthControls);


    // --- 5, 6, 7. Utility Functions (Slider, Scroll, Nav) ---
    const initSlider = () => { 
        const slider = document.querySelector('.hero-slider');
        const slides = document.querySelectorAll('.hero-slide');
        const sliderNav = document.querySelector('.slider-nav');
        if (!slider || slides.length <= 1) return;

        let currentIndex = 0;
        let slideInterval;

        slides.forEach((_, i) => {
            const dot = document.createElement('div');
            dot.classList.add('slider-dot');
            if (i === 0) dot.classList.add('active');
            dot.addEventListener('click', () => {
                currentIndex = i;
                updateSlider();
                resetInterval();
            });
            sliderNav.appendChild(dot);
        });
        
        const dots = document.querySelectorAll('.slider-dot');
        const updateSlider = () => {
            slider.style.transform = `translateX(-${currentIndex * 100}%)`;
            dots.forEach((dot, i) => dot.classList.toggle('active', i === currentIndex));
        };

        const nextSlide = () => {
            currentIndex = (currentIndex + 1) % slides.length;
            updateSlider();
        };

        const resetInterval = () => {
            clearInterval(slideInterval);
            slideInterval = setInterval(nextSlide, 5000);
        };

        slider.addEventListener('mouseenter', () => clearInterval(slideInterval));
        slider.addEventListener('mouseleave', resetInterval);

        resetInterval();
    };

    const initScrollEffects = () => {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });
        document.querySelectorAll('.animated-section').forEach(el => observer.observe(el));

        window.addEventListener('scroll', () => {
            if (header) header.classList.toggle('scrolled', window.scrollY > 50);
        });
    };

    const initMobileNav = () => {
        if (!primaryMenuBtn || !navLinks) return; // Use primaryMenuBtn
        const menuIcon = primaryMenuBtn.querySelector('i');
        
        primaryMenuBtn.addEventListener("click", () => {
            const isActive = navLinks.classList.toggle("active");
            document.body.classList.toggle("nav-open");
            menuIcon.className = isActive ? 'fas fa-times' : 'fas fa-bars';
        });

        navLinks.addEventListener('click', (e) => {
             const target = e.target.closest('a');
             if (target) {
                 if (navLinks.classList.contains("active")) {
                    navLinks.classList.remove('active');
                    document.body.classList.remove('nav-open');
                    menuIcon.className = 'fas fa-bars';
                 }
             }
        });
    };

    // --- 8. Event Listeners (Updated Quantity Logic) ---
    if (productGrid) {
        productGrid.addEventListener('click', (e) => {
            const card = e.target.closest('.product-card');
            if (!card) return;
            
            const productId = card.dataset.id;
            const product = products.find(p => p.id === productId);
            if (!product || product.isLive) return; // Skip if live product

            const isGoat = product.id === 'goat';
            const isMeat = product.isMeat;
            const qtyEl = card.querySelector('.qty');
            let currentQty = parseFloat(qtyEl.textContent);

            if (e.target.classList.contains('plus-btn')) {
                const step = isMeat ? 0.25 : 1;
                currentQty += step;
            } else if (e.target.classList.contains('minus-btn')) {
                const step = isMeat ? 0.25 : 1;
                
                let minQty;
                if (isGoat) {
                    minQty = 0.75; 
                } else if (isMeat) {
                    minQty = 0.5; 
                } else {
                    minQty = 1;
                }

                currentQty = Math.max(minQty, currentQty - step);
            } else if (e.target.classList.contains('add-to-cart-btn')) {
                 handleAddToCart(productId, currentQty, card);
                 return; 
            }
            
            // Update the display
            qtyEl.textContent = currentQty.toFixed(isMeat ? 2 : 0);
            
            // Update the displayed price
            updatePriceDisplay(card, product); 
        });
    }
    
    // --- 9. Initialization ---
    document.addEventListener("DOMContentLoaded", function() {
        renderProducts();
        updateCartCount();
        initSlider();
        initScrollEffects();
        initMobileNav();
        
        // Final initialization of dynamic prices after rendering
        document.querySelectorAll('.product-card').forEach(card => {
            const product = products.find(p => p.id === card.dataset.id);
            if (product) updatePriceDisplay(card, product);
        });
    });
</script>
</body>
</html>
