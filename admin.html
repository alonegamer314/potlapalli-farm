<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Panel - Potlapalli Farm</title>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet" />
<!-- FontAwesome Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<style>
  /* Root variables for colors */
  :root {
    --primary-color: #27ae60;
    --secondary-color: #2c3e50;
    --background-light: #f8f9fa;
    --text-dark: #333;
    --white: #fff;
    --border-light: #e0e0e0;
    --danger-color: #e74c3c;
  }

  /* Reset & base styles */
  * {
    margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif;
  }
  body {
    background: var(--background-light);
    color: var(--text-dark);
  }
  .container {
    width: 95%;
    max-width: 1400px;
    margin: 0 auto;
  }

  /* Login View */
  #admin-login-view {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
  }
  .login-box {
    background: var(--white);
    padding: 2.5rem;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 400px;
    text-align: center;
  }
  .login-box h1 {
    font-family: 'Playfair Display', serif;
    margin-bottom: 2rem;
    color: var(--secondary-color);
  }
  .input-group {
    margin-bottom: 1.5rem;
    text-align: left;
  }
  .input-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
  }
  .input-group input {
    width: 100%;
    padding: 12px;
    border: 1px solid #ccc;
    border-radius: 8px;
  }
  .btn {
    width: 100%;
    padding: 1rem;
    background: var(--primary-color);
    color: var(--white);
    border: none;
    border-radius: 8px;
    font-size: 1.1rem;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  .btn:hover {
    background: #219150;
  }

  /* Dashboard View */
  #admin-dashboard-view {
    display: none;
  }
  .admin-layout {
    display: flex;
    min-height: 100vh;
  }
  /* Sidebar */
  .sidebar {
    width: 240px;
    background: var(--secondary-color);
    color: #ecf0f1;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
  }
  .sidebar-header {
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #34495e;
    text-align: center;
  }
  .sidebar-header h2 {
    font-family: 'Playfair Display', serif;
    color: var(--white);
  }
  .sidebar-nav {
    margin-top: 2rem;
  }
  .sidebar-nav a {
    display: flex;
    align-items: center;
    gap: 1rem;
    color: #bdc3c7;
    text-decoration: none;
    padding: 0.9rem 1rem;
    border-radius: 8px;
    margin-bottom: 0.5rem;
    transition: all 0.3s ease;
    font-weight: 500;
  }
  .sidebar-nav a:hover,
  .sidebar-nav a.active {
    background: #34495e;
    color: var(--white);
  }
  .sidebar-footer {
    margin-top: auto;
  }
  .sidebar-footer button {
    width: 100%;
    background: var(--danger-color);
    color: white;
    border: none;
    padding: 0.8rem;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
  }
  .sidebar-footer button:hover {
    background: #c0392b;
  }

  /* Main Content */
  .main-content {
    flex: 1;
    padding: 2rem;
    overflow-x: auto;
  }
  .main-content > div {
    display: none;
  }
  .main-content > div.active {
    display: block;
  }
  .main-content h2 {
    font-family: 'Playfair Display', serif;
    margin-bottom: 1.5rem;
  }

  /* Stats Grid */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2.5rem;
  }
  .stat-card {
    background: var(--white);
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    text-align: center;
  }
  .stat-card h3 {
    font-size: 1rem;
    color: #555;
    margin-bottom: 0.5rem;
  }
  .stat-card .value {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary-color);
  }

  /* Table styles */
  .table-container {
    background: var(--white);
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
  }
  .table-toolbar {
    padding: 1rem;
    border-bottom: 1px solid var(--border-light);
  }
  .table-toolbar input {
    padding: 0.8rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    min-width: 300px;
    font-size: 1rem;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
  }
  th, td {
    padding: 1rem;
    text-align: left;
    border-bottom: 1px solid var(--border-light);
    vertical-align: top;
  }
  th {
    background: #f9fafb;
    font-weight: 600;
  }
  .customer-details {
    font-weight: 600;
  }
  .customer-details small {
    display: block;
    font-weight: normal;
    color: #555;
    margin-top: 2px;
  }
  .customer-details .address {
    font-style: italic;
    max-width: 250px;
  }
  .order-table .items-preview {
    font-size: 0.9rem;
    color: #555;
    max-width: 300px;
  }
  .order-table .view-details-btn {
    font-size: 0.8rem;
    padding: 0.3rem 0.8rem;
    cursor: pointer;
    border: none;
    background: var(--primary-color);
    color: white;
    border-radius: 6px;
    transition: background 0.3s ease;
  }
  .order-table .view-details-btn:hover {
    background: #219150;
  }
  select.status-select {
    padding: 0.4rem 0.6rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 0.9rem;
    cursor: pointer;
    width: 140px;
  }

  /* Modal */
  .modal-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    z-index: 2000;
    display: none;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  .modal-overlay.show {
    display: flex;
    opacity: 1;
  }
  .modal-content {
    background: var(--white);
    padding: 2rem;
    border-radius: 15px;
    width: 90%;
    max-width: 600px;
    text-align: left;
    max-height: 80vh;
    overflow-y: auto;
  }
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }
  .close-modal {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--danger-color);
  }
  #modal-order-items {
    list-style: none;
  }
  #modal-order-items li {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid #eee;
  }

  /* Toast Notification */
  .toast {
    position: fixed;
    bottom: -100px;
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--secondary-color);
    color: var(--white);
    padding: 1rem 1.5rem;
    border-radius: 50px;
    z-index: 2000;
    transition: all 0.5s;
    font-weight: 600;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }
  .toast.show {
    bottom: 20px;
  }
  .toast.error {
    background-color: var(--danger-color);
  }

  /* Responsive tweaks */
  @media(max-width: 768px) {
    .admin-layout {
      flex-direction: column;
    }
    .sidebar {
      width: 100%;
      flex-direction: row;
      justify-content: space-around;
      padding: 1rem 0.5rem;
    }
    .sidebar-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0;
    }
    .sidebar-nav a {
      padding: 0.5rem 0.8rem;
      margin-bottom: 0;
      font-size: 0.9rem;
      flex: 1 1 45%;
      justify-content: center;
    }
    .sidebar-footer {
      margin-top: 0.5rem;
      text-align: center;
    }
  }
</style>
</head>
<body>
  <!-- LOGIN VIEW -->
  <div id="admin-login-view">
    <div class="login-box">
      <h1>Admin Login</h1>
      <form id="adminLoginForm">
        <div class="input-group">
          <label for="adminEmail">Email</label>
          <input type="email" id="adminEmail" placeholder="admin@example.com" required />
        </div>
        <div class="input-group">
          <label for="adminPassword">Password</label>
          <input type="password" id="adminPassword" placeholder="Your password" required />
        </div>
        <button type="submit" class="btn">Login</button>
      </form>
    </div>
  </div>

  <!-- DASHBOARD VIEW -->
  <div id="admin-dashboard-view" aria-live="polite" aria-atomic="true">
    <div class="admin-layout">
      <!-- Sidebar -->
      <aside class="sidebar" role="navigation" aria-label="Admin navigation">
        <div class="sidebar-header">
          <h2>Admin Panel</h2>
        </div>
        <nav class="sidebar-nav" role="tablist" aria-orientation="vertical">
          <a href="#" class="nav-link active" data-tab="dashboard" role="tab" aria-selected="true" tabindex="0"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
          <a href="#" class="nav-link" data-tab="orders" role="tab" aria-selected="false" tabindex="-1"><i class="fas fa-box-open"></i> Orders</a>
          <a href="#" class="nav-link" data-tab="customers" role="tab" aria-selected="false" tabindex="-1"><i class="fas fa-users"></i> Customers</a>
          <a href="#" class="nav-link" data-tab="products" role="tab" aria-selected="false" tabindex="-1"><i class="fas fa-leaf"></i> Products</a>
        </nav>
        <div class="sidebar-footer">
          <button id="logoutBtn" aria-label="Logout from admin panel"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>
      </aside>

      <!-- Main content -->
      <main class="main-content" role="main">
        <!-- DASHBOARD TAB -->
        <section id="tab-dashboard" class="active" role="tabpanel" tabindex="0" aria-labelledby="dashboard-tab">
          <h2>Dashboard</h2>
          <div class="stats-grid" aria-live="polite" aria-atomic="true">
            <div class="stat-card" role="region" aria-label="Total Revenue">
              <h3>Total Revenue</h3>
              <div class="value" id="total-revenue">₹0</div>
            </div>
            <div class="stat-card" role="region" aria-label="Total Orders">
              <h3>Total Orders</h3>
              <div class="value" id="total-orders">0</div>
            </div>
            <div class="stat-card" role="region" aria-label="New Customers">
              <h3>New Customers</h3>
              <div class="value" id="total-customers">0</div>
            </div>
            <div class="stat-card" role="region" aria-label="Total Products">
              <h3>Total Products</h3>
              <div class="value" id="total-products">0</div>
            </div>
          </div>
        </section>

        <!-- ORDERS TAB -->
        <section id="tab-orders" role="tabpanel" tabindex="0" aria-labelledby="orders-tab">
          <h2>Orders</h2>
          <div class="table-container" aria-live="polite">
            <div class="table-toolbar">
              <input type="search" id="orderSearchInput" placeholder="Search orders by customer, ID or status" aria-label="Search orders" />
            </div>
            <table class="order-table" aria-describedby="orderTableDesc" role="grid">
              <caption id="orderTableDesc" class="sr-only">List of recent orders with details and status</caption>
              <thead>
                <tr>
                  <th scope="col">Order ID</th>
                  <th scope="col">Customer</th>
                  <th scope="col">Items</th>
                  <th scope="col">Total Amount</th>
                  <th scope="col">Status</th>
                  <th scope="col">Actions</th>
                </tr>
              </thead>
              <tbody id="ordersTableBody">
                <!-- Orders will be dynamically loaded here -->
              </tbody>
            </table>
          </div>
        </section>

        <!-- CUSTOMERS TAB -->
        <section id="tab-customers" role="tabpanel" tabindex="0" aria-labelledby="customers-tab">
          <h2>Customers</h2>
          <div class="table-container" aria-live="polite">
            <div class="table-toolbar">
              <input type="search" id="customerSearchInput" placeholder="Search customers by name or email" aria-label="Search customers" />
            </div>
            <table aria-describedby="customerTableDesc" role="grid">
              <caption id="customerTableDesc" class="sr-only">List of customers with contact details</caption>
              <thead>
                <tr>
                  <th scope="col">Name</th>
                  <th scope="col">Email</th>
                  <th scope="col">Phone</th>
                  <th scope="col">Address</th>
                  <th scope="col">Total Orders</th>
                </tr>
              </thead>
              <tbody id="customersTableBody">
                <!-- Customers will be dynamically loaded here -->
              </tbody>
            </table>
          </div>
        </section>

        <!-- PRODUCTS TAB -->
        <section id="tab-products" role="tabpanel" tabindex="0" aria-labelledby="products-tab">
          <h2>Products</h2>
          <div class="table-container" aria-live="polite">
            <div class="table-toolbar">
              <input type="search" id="productSearchInput" placeholder="Search products by name or category" aria-label="Search products" />
            </div>
            <table aria-describedby="productTableDesc" role="grid">
              <caption id="productTableDesc" class="sr-only">List of products with details and stock status</caption>
              <thead>
                <tr>
                  <th scope="col">Product Name</th>
                  <th scope="col">Category</th>
                  <th scope="col">Price (₹)</th>
                  <th scope="col">Stock</th>
                  <th scope="col">Actions</th>
                </tr>
              </thead>
              <tbody id="productsTableBody">
                <!-- Products will be dynamically loaded here -->
              </tbody>
            </table>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- ORDER DETAILS MODAL -->
  <div id="orderDetailsModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="orderDetailsTitle" tabindex="-1">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="orderDetailsTitle">Order Details</h3>
        <button class="close-modal" aria-label="Close order details modal">&times;</button>
      </div>
      <div id="orderDetailsBody">
        <p><strong>Order ID:</strong> <span id="modalOrderId"></span></p>
        <p><strong>Customer:</strong> <span id="modalCustomerName"></span></p>
        <p><strong>Email:</strong> <span id="modalCustomerEmail"></span></p>
        <p><strong>Phone:</strong> <span id="modalCustomerPhone"></span></p>
        <p><strong>Shipping Address:</strong> <span id="modalCustomerAddress"></span></p>
        <p><strong>Order Status:</strong> <span id="modalOrderStatus"></span></p>
        <p><strong>Items:</strong></p>
        <ul id="modal-order-items">
          <!-- Items will be dynamically added here -->
        </ul>
        <p><strong>Total Amount:</strong> ₹<span id="modalOrderTotal"></span></p>
      </div>
    </div>
  </div>

  <!-- TOAST NOTIFICATION -->
  <div id="toast" role="alert" aria-live="assertive" aria-atomic="true" class="toast"></div>

  <!-- Firebase App & Firestore SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

  <script>
    // Firebase configuration (replace with your actual config)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // UI elements
    const loginView = document.getElementById('admin-login-view');
    const dashboardView = document.getElementById('admin-dashboard-view');
    const adminLoginForm = document.getElementById('adminLoginForm');
    const logoutBtn = document.getElementById('logoutBtn');
    const navLinks = document.querySelectorAll('.sidebar-nav a');
    const mainSections = document.querySelectorAll('main > section');

    // Toast notification
    const toast = document.getElementById('toast');

    // Modal elements
    const orderDetailsModal = document.getElementById('orderDetailsModal');
    const closeModalBtn = orderDetailsModal.querySelector('.close-modal');

    // Login form submit handler
    adminLoginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('adminEmail').value.trim();
      const password = document.getElementById('adminPassword').value.trim();
      try {
        await auth.signInWithEmailAndPassword(email, password);
        showToast('Login successful!');
      } catch (error) {
        showToast(error.message, true);
      }
    });

    // Logout button handler
    logoutBtn.addEventListener('click', async () => {
      await auth.signOut();
      showToast('Logged out successfully!');
    });

    // Authentication state listener
    auth.onAuthStateChanged(user => {
      if (user) {
        // Show dashboard
        loginView.style.display = 'none';
        dashboardView.style.display = 'block';
        loadDashboardData();
        loadOrders();
        loadCustomers();
        loadProducts();
      } else {
        // Show login
        loginView.style.display = 'flex';
        dashboardView.style.display = 'none';
        clearTables();
      }
    });

    // Navigation tab switching
    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetTab = link.dataset.tab;

        // Update active link
        navLinks.forEach(l => {
          l.classList.toggle('active', l === link);
          l.setAttribute('aria-selected', l === link ? 'true' : 'false');
          l.tabIndex = l === link ? 0 : -1;
        });

        // Show corresponding tab content
        mainSections.forEach(section => {
          section.classList.toggle('active', section.id === 'tab-' + targetTab);
        });
      });
    });

    // Toast helper
    function showToast(message, isError = false) {
      toast.textContent = message;
      toast.className = 'toast show' + (isError ? ' error' : '');
      setTimeout(() => {
        toast.className = 'toast';
      }, 3500);
    }

    // Clear tables on logout
    function clearTables() {
      document.getElementById('ordersTableBody').innerHTML = '';
      document.getElementById('customersTableBody').innerHTML = '';
      document.getElementById('productsTableBody').innerHTML = '';
      document.getElementById('total-revenue').textContent = '₹0';
      document.getElementById('total-orders').textContent = '0';
      document.getElementById('total-customers').textContent = '0';
      document.getElementById('total-products').textContent = '0';
    }

    // Load dashboard stats
    async function loadDashboardData() {
      try {
        const ordersSnapshot = await db.collection('orders').get();
        const customersSnapshot = await db.collection('customers').get();
        const productsSnapshot = await db.collection('products').get();

        let totalRevenue = 0;
        let totalOrders = ordersSnapshot.size;
        let totalCustomers = customersSnapshot.size;
        let totalProducts = productsSnapshot.size;

        ordersSnapshot.forEach(doc => {
          const data = doc.data();
          if (data.totalAmount) totalRevenue += data.totalAmount;
        });

        document.getElementById('total-revenue').textContent = `₹${totalRevenue.toFixed(2)}`;
        document.getElementById('total-orders').textContent = totalOrders;
        document.getElementById('total-customers').textContent = totalCustomers;
        document.getElementById('total-products').textContent = totalProducts;
      } catch (error) {
        showToast('Failed to load dashboard data: ' + error.message, true);
      }
    }

    // Load orders and display in table
    async function loadOrders() {
      const tbody = document.getElementById('ordersTableBody');
      tbody.innerHTML = '';
      try {
        const ordersSnapshot = await db.collection('orders').orderBy('createdAt', 'desc').limit(50).get();
        ordersSnapshot.forEach(doc => {
          const order = doc.data();
          const orderId = doc.id;
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${orderId}</td>
            <td class="customer-details">${order.customerName || 'N/A'}<br/><small>${order.customerEmail || ''}</small></td>
            <td class="items-preview">${order.items ? order.items.map(i => `${i.name} x${i.quantity}`).join(', ') : 'N/A'}</td>
            <td>₹${order.totalAmount ? order.totalAmount.toFixed(2) : '0.00'}</td>
            <td>
              <select class="status-select" aria-label="Change order status for ${orderId}">
                <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
                <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>Shipped</option>
                <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
                <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
              </select>
            </td>
            <td><button class="view-details-btn" aria-label="View details for order ${orderId}">View</button></td>
          `;
          // Attach event listeners
          tr.querySelector('.view-details-btn').addEventListener('click', () => showOrderDetails(orderId, order));
          tr.querySelector('.status-select').addEventListener('change', e => updateOrderStatus(orderId, e.target.value));
          tbody.appendChild(tr);
        });
      } catch (error) {
        showToast('Failed to load orders: ' + error.message, true);
      }
    }

    // Update order status in Firestore
    async function updateOrderStatus(orderId, newStatus) {
      try {
        await db.collection('orders').doc(orderId).update({ status: newStatus });
        showToast(`Order ${orderId} status updated to ${newStatus}`);
        loadDashboardData();
      } catch (error) {
        showToast('Failed to update status: ' + error.message, true);
      }
    }

    // Show order details modal
    function showOrderDetails(orderId, order) {
      document.getElementById('modalOrderId').textContent = orderId;
      document.getElementById('modalCustomerName').textContent = order.customerName || 'N/A';
      document.getElementById('modalCustomerEmail').textContent = order.customerEmail || 'N/A';
      document.getElementById('modalCustomerPhone').textContent = order.customerPhone || 'N/A';
      document.getElementById('modalCustomerAddress').textContent = order.shippingAddress || 'N/A';
      document.getElementById('modalOrderStatus').textContent = order.status || 'N/A';
      document.getElementById('modalOrderTotal').textContent = order.totalAmount ? order.totalAmount.toFixed(2) : '0.00';

      const itemsList = document.getElementById('modal-order-items');
      itemsList.innerHTML = '';
      if (order.items && order.items.length > 0) {
        order.items.forEach(item => {
          const li = document.createElement('li');
          li.textContent = `${item.name} x${item.quantity} - ₹${(item.price * item.quantity).toFixed(2)}`;
          itemsList.appendChild(li);
        });
      } else {
        itemsList.innerHTML = '<li>No items found</li>';
      }

      orderDetailsModal.classList.add('show');
      orderDetailsModal.focus();
    }

    // Close modal button
    closeModalBtn.addEventListener('click', () => {
      orderDetailsModal.classList.remove('show');
    });

    // Close modal on overlay click
    orderDetailsModal.addEventListener('click', (e) => {
      if (e.target === orderDetailsModal) {
        orderDetailsModal.classList.remove('show');
      }
    });

    // Keyboard accessibility for modal (Esc key closes modal)
    window.addEventListener('keydown', e => {
      if (e.key === 'Escape' && orderDetailsModal.classList.contains('show')) {
        orderDetailsModal.classList.remove('show');
      }
    });

    // Search filters for Orders
    document.getElementById('orderSearchInput').addEventListener('input', e => {
      const query = e.target.value.toLowerCase();
      const rows = document.querySelectorAll('#ordersTableBody tr');
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(query) ? '' : 'none';
      });
    });

    // Load customers data and populate table
    async function loadCustomers() {
      const tbody = document.getElementById('customersTableBody');
      tbody.innerHTML = '';
      try {
        const snapshot = await db.collection('customers').orderBy('name').get();
        snapshot.forEach(doc => {
          const cust = doc.data();
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${cust.name || 'N/A'}</td>
            <td>${cust.email || 'N/A'}</td>
            <td>${cust.phone || 'N/A'}</td>
            <td class="address">${cust.address || 'N/A'}</td>
            <td>${cust.totalOrders || 0}</td>
          `;
          tbody.appendChild(tr);
        });
      } catch (error) {
        showToast('Failed to load customers: ' + error.message, true);
      }
    }

    // Search customers filter
    document.getElementById('customerSearchInput').addEventListener('input', e => {
      const query = e.target.value.toLowerCase();
      const rows = document.querySelectorAll('#customersTableBody tr');
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(query) ? '' : 'none';
      });
    });

    // Load products data and populate table
    async function loadProducts() {
      const tbody = document.getElementById('productsTableBody');
      tbody.innerHTML = '';
      try {
        const snapshot = await db.collection('products').orderBy('name').get();
        snapshot.forEach(doc => {
          const prod = doc.data();
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${prod.name || 'N/A'}</td>
            <td>${prod.category || 'N/A'}</td>
            <td>₹${prod.price ? prod.price.toFixed(2) : '0.00'}</td>
            <td>${prod.stock || 0}</td>
            <td><!-- Future actions like edit/delete --></td>
          `;
          tbody.appendChild(tr);
        });
      } catch (error) {
        showToast('Failed to load products: ' + error.message, true);
      }
    }

    // Search products filter
    document.getElementById('productSearchInput').addEventListener('input', e => {
      const query = e.target.value.toLowerCase();
      const rows = document.querySelectorAll('#productsTableBody tr');
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(query) ? '' : 'none';
      });
    });

  </script>
</body>
</html>
