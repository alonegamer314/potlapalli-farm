<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel - Potlapalli Farm</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #27ae60;
            --secondary-color: #2c3e50;
            --background-light: #f8f9fa;
            --text-dark: #333;
            --white: #fff;
            --border-light: #e0e0e0;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--background-light); color: var(--text-dark); }
        .container { width: 95%; max-width: 1400px; margin: 0 auto; }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }
        
        /* Loader Styles */
        #loader-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.7); z-index: 9999; display: none; align-items: center; justify-content: center; }
        #loader-overlay.show { display: flex; }
        .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Login View */
        #admin-login-view { display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .login-box { background: var(--white); padding: 2.5rem; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        .login-box h1 { font-family: 'Playfair Display', serif; margin-bottom: 2rem; color: var(--secondary-color); }
        .input-group { margin-bottom: 1.5rem; text-align: left; }
        .input-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .input-group input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem; }
        .btn { width: 100%; padding: 1rem; background: var(--primary-color); color: var(--white); border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; transition: background 0.3s ease; }
        .btn:hover { background: #219150; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: #219150; }
        .btn-danger { background-color: var(--danger-color); color: white; }
        .btn-danger:hover { background-color: #c0392b; }
        .btn-warning { background-color: var(--warning-color); color: white; }
        .btn-warning:hover { background-color: #e67e22; }

        /* Dashboard View */
        #admin-dashboard-view { display: none; }
        .admin-layout { display: flex; min-height: 100vh; }
        .sidebar { width: 240px; background: var(--secondary-color); color: #ecf0f1; padding: 1.5rem; display: flex; flex-direction: column; }
        .sidebar-header { padding-bottom: 1.5rem; border-bottom: 1px solid #34495e; text-align: center; }
        .sidebar-header h2 { font-family: 'Playfair Display', serif; color: var(--white); }
        .sidebar-nav { margin-top: 2rem; }
        .sidebar-nav a { display: flex; align-items: center; gap: 1rem; color: #bdc3c7; text-decoration: none; padding: 0.9rem 1rem; border-radius: 8px; margin-bottom: 0.5rem; transition: all 0.3s ease; font-weight: 500; }
        .sidebar-nav a:hover, .sidebar-nav a.active { background: #34495e; color: var(--white); }
        .sidebar-footer { margin-top: auto; }
        .sidebar-footer button { width: 100%; background: var(--danger-color); color: white; border: none; padding: 0.8rem; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .sidebar-footer button:hover { background: #c0392b; }

        .main-content { flex: 1; padding: 2rem; overflow-x: auto; }
        .main-content > section { display: none; }
        .main-content > section.active { display: block; }
        .main-content h2 { font-family: 'Playfair Display', serif; margin-bottom: 1.5rem; }
        
        .chart-container { background: var(--white); padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 2.5rem; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2.5rem; }
        .stat-card { background: var(--white); padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); text-align: center; }
        .stat-card h3 { font-size: 1rem; color: #555; margin-bottom: 0.5rem; }
        .stat-card .value { font-size: 2.5rem; font-weight: 700; color: var(--primary-color); }

        .table-container { background: var(--white); border-radius: 8px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .table-toolbar { padding: 1rem; border-bottom: 1px solid var(--border-light); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .table-toolbar input { padding: 0.8rem; border: 1px solid #ccc; border-radius: 6px; min-width: 300px; font-size: 1rem; }
        table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
        th, td { padding: 1rem; text-align: left; border-bottom: 1px solid var(--border-light); vertical-align: middle; }
        th { background: #f9fafb; font-weight: 600; }
        .actions-cell { display: flex; gap: 0.5rem; }
        .actions-cell button { padding: 0.3rem 0.8rem; font-size: 0.8rem; cursor: pointer; border: none; border-radius: 6px; transition: background 0.3s ease; }
        .empty-row td { text-align: center; padding: 2rem; color: #777; font-style: italic; }

        .customer-details { font-weight: 600; }
        .customer-details small { display: block; font-weight: normal; color: #555; margin-top: 2px; }
        .customer-details .address { font-style: italic; max-width: 250px; }
        .order-table .items-preview { font-size: 0.9rem; color: #555; max-width: 300px; }
        
        select.status-select { padding: 0.4rem 0.6rem; border-radius: 6px; border: 1px solid #ccc; font-size: 0.9rem; cursor: pointer; width: 140px; }
        
        .status-badge { padding: 0.2em 0.6em; border-radius: 12px; font-size: 0.8rem; font-weight: 600; color: white; }
        .status-Processing { background-color: var(--warning-color); }
        .status-Shipped { background-color: #3498db; }
        .status-Delivered { background-color: var(--primary-color); }
        .status-Cancelled { background-color: var(--danger-color); }

        /* Modal Styles */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal-content { background: var(--white); padding: 2rem; border-radius: 15px; width: 90%; max-width: 600px; text-align: left; max-height: 90vh; overflow-y: auto; transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-light); padding-bottom: 1rem; }
        .modal-header h3 { font-family: 'Playfair Display', serif; font-size: 1.5rem; }
        .close-modal { background: none; border: none; font-size: 1.8rem; cursor: pointer; color: var(--text-dark); line-height: 1; }
        #modal-order-items { list-style: none; margin-bottom: 1rem; }
        #modal-order-items li { display: flex; justify-content: space-between; padding: 0.6rem 0; border-bottom: 1px solid #eee; }
        .modal-footer { text-align: right; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--border-light); }
        .modal-footer button { padding: 0.7rem 1.5rem; font-size: 1rem; border-radius: 8px; }

        /* Toast Styles */
        .toast { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background-color: var(--secondary-color); color: var(--white); padding: 1rem 1.5rem; border-radius: 50px; z-index: 3000; transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); font-weight: 600; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .toast.show { bottom: 20px; }
        .toast.error { background-color: var(--danger-color); }

        /* Responsive Styles */
        @media(max-width: 768px) {
            .admin-layout { flex-direction: column; }
            .sidebar { width: 100%; flex-direction: row; justify-content: space-between; align-items: center; padding: 0.5rem; flex-wrap: wrap; }
            .sidebar-header { width: 100%; text-align: left; border-bottom: none; padding: 0.5rem; }
            .sidebar-nav { display: flex; gap: 0.5rem; margin-top: 0; order: 3; width: 100%; overflow-x: auto; padding: 0.5rem 0; }
            .sidebar-nav a { padding: 0.5rem 0.8rem; margin-bottom: 0; font-size: 0.9rem; flex-shrink: 0; }
            .sidebar-footer { margin-top: 0; }
            .main-content { padding: 1rem; }
            .table-toolbar { flex-direction: column; align-items: stretch; }
        }
    </style>
</head>
<body>
    
    <div id="loader-overlay"><div class="spinner"></div></div>

    <div id="admin-login-view">
        <div class="login-box">
            <h1>Admin Login</h1>
            <form id="adminLoginForm">
                <div class="input-group">
                    <label for="adminEmail">Email</label>
                    <input type="email" id="adminEmail" placeholder="admin@example.com" required />
                </div>
                <div class="input-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" placeholder="Your password" required />
                </div>
                <button type="submit" class="btn">Login</button>
            </form>
        </div>
    </div>

    <div id="admin-dashboard-view">
        <div class="admin-layout">
            <aside class="sidebar" role="navigation" aria-label="Admin navigation">
                <div class="sidebar-header"><h2>Admin Panel</h2></div>
                <nav class="sidebar-nav" role="tablist" aria-orientation="vertical">
                    <a href="#" id="dashboard-tab" class="nav-link active" data-tab="dashboard" role="tab"><i class="fas fa-chart-line"></i> Dashboard</a>
                    <a href="#" id="orders-tab" class="nav-link" data-tab="orders" role="tab"><i class="fas fa-box-open"></i> Orders</a>
                    <a href="#" id="customers-tab" class="nav-link" data-tab="customers" role="tab"><i class="fas fa-users"></i> Customers</a>
                </nav>
                <div class="sidebar-footer">
                    <button id="logoutBtn" aria-label="Logout from admin panel"><i class="fas fa-sign-out-alt"></i> Logout</button>
                </div>
            </aside>
            <main class="main-content" role="main">
                <section id="tab-dashboard" class="active" role="tabpanel">
                    <h2>Dashboard</h2>
                    <div class="stats-grid" aria-live="polite">
                        <div class="stat-card"><h3>Total Revenue</h3><div class="value" id="total-revenue">₹0</div></div>
                        <div class="stat-card"><h3>Total Orders</h3><div class="value" id="total-orders">0</div></div>
                        <div class="stat-card"><h3>New Customers</h3><div class="value" id="total-customers">0</div></div>
                    </div>
                    <div class="chart-container">
                        <h2>Recent Revenue (Last 7 Days)</h2>
                        <canvas id="revenueChart"></canvas>
                    </div>
                </section>
                <section id="tab-orders" role="tabpanel">
                    <h2>Manage Orders</h2>
                    <div class="table-container">
                        <div class="table-toolbar"><input type="search" id="order-search" placeholder="Search by Order ID, Customer Name, or Status..." /></div>
                        <table><thead id="orders-table-head"></thead><tbody id="orders-table-body"></tbody></table>
                    </div>
                </section>
                <section id="tab-customers" role="tabpanel">
                    <h2>Customers</h2>
                     <div class="table-container">
                        <div class="table-toolbar"><input type="search" id="customer-search" placeholder="Search by Name, Email, or Phone..." /></div>
                        <table><thead id="customers-table-head"></thead><tbody id="customers-table-body"></tbody></table>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <div id="orderDetailsModal" class="modal-overlay" role="dialog">
        <div class="modal-content">
            <div class="modal-header"><h3>Order Details</h3><button class="close-modal">&times;</button></div>
            <div id="orderDetailsBody">
                <p><strong>Order ID:</strong> <span id="modalOrderId"></span></p>
                <p><strong>Customer:</strong> <span id="modalCustomerName"></span></p>
                <p><strong>Shipping Address:</strong> <span id="modalCustomerAddress"></span></p>
                <hr style="margin: 1rem 0; border: 0; border-top: 1px solid var(--border-light);" />
                <p><strong>Items:</strong></p>
                <ul id="modal-order-items"></ul>
                <p style="text-align: right; font-size: 1.2rem; font-weight: bold;"><strong>Total:</strong> ₹<span id="modalOrderTotal"></span></p>
            </div>
        </div>
    </div>
    <div id="toast" role="alert" class="toast"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, doc, getDoc, onSnapshot, updateDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAXmkk4DfFahS9euqh-xR7uS3JpRS0Ll0c",
            authDomain: "potlapallifarm.firebaseapp.com",
            projectId: "potlapallifarm",
            storageBucket: "potlapallifarm.firebasestorage.app",
            messagingSenderId: "1017629729159",
            appId: "1:1017629729159:web:357c420a9de335d427b322"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- DOM Elements ---
        const loader = document.getElementById('loader-overlay');
        const loginView = document.getElementById('admin-login-view');
        const dashboardView = document.getElementById('admin-dashboard-view');
        const adminLoginForm = document.getElementById('adminLoginForm');
        const adminEmailInput = document.getElementById('adminEmail');
        const adminPasswordInput = document.getElementById('adminPassword');
        const logoutBtn = document.getElementById('logoutBtn');
        const toast = document.getElementById('toast');

        // --- State ---
        let allOrders = [], allCustomers = [];
        let revenueChartInstance = null;
        let unsubscribeOrders, unsubscribeCustomers;

        // --- Utility Functions ---
        const showLoader = (show) => loader.classList.toggle('show', show);
        const showToast = (message, isError = false) => {
            toast.textContent = message;
            toast.className = `toast show ${isError ? 'error' : ''}`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        };
        const debounce = (func, delay) => {
            let timeout;
            return (...args) => {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), delay);
            };
        };

        // --- Authentication ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                showLoader(true);
                const userDocRef = doc(db, "users", user.uid);
                const userDoc = await getDoc(userDocRef);
                if (userDoc.exists() && userDoc.data().role === 'admin') {
                    loginView.style.display = 'none';
                    dashboardView.style.display = 'block';
                    initializeDashboard();
                } else {
                    await signOut(auth);
                    showToast('Access Denied. You are not an admin.', true);
                    showLoader(false);
                }
            } else {
                loginView.style.display = 'flex';
                dashboardView.style.display = 'none';
                if (unsubscribeOrders) unsubscribeOrders();
                if (unsubscribeCustomers) unsubscribeCustomers();
                showLoader(false);
            }
        });

        adminLoginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            showLoader(true);
            const email = adminEmailInput.value;
            const password = adminPasswordInput.value;
            try {
                await signInWithEmailAndPassword(auth, email, password);
                // onAuthStateChanged will handle the rest
            } catch (error) {
                showToast(error.message, true);
                showLoader(false);
            }
        });

        logoutBtn.addEventListener('click', async () => {
            await signOut(auth);
            showToast('Logged out successfully.');
        });
        
        // --- Dashboard Initialization ---
        function initializeDashboard() {
            setupTabNavigation();
            listenForData();
            setupSearch();
            showLoader(false);
        }
        
        // --- Tab Navigation ---
        function setupTabNavigation() {
            const navLinks = document.querySelectorAll('.sidebar-nav .nav-link');
            const tabs = document.querySelectorAll('.main-content > section');
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetTab = link.dataset.tab;
                    
                    navLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    
                    tabs.forEach(tab => {
                        tab.classList.toggle('active', tab.id === `tab-${targetTab}`);
                    });
                });
            });
        }
        
        // --- Real-time Data Listening ---
        function listenForData() {
            // Orders Listener
            const ordersQuery = query(collection(db, "orders"), orderBy("orderDate", "desc"));
            unsubscribeOrders = onSnapshot(ordersQuery, (snapshot) => {
                allOrders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderOrdersTable(allOrders);
                updateDashboardStats();
            });

            // Customers Listener
            const usersQuery = query(collection(db, "users"));
            unsubscribeCustomers = onSnapshot(usersQuery, (snapshot) => {
                allCustomers = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderCustomersTable(allCustomers);
                updateDashboardStats();
            });
        }
        
        // --- Dashboard Stats & Chart ---
        function updateDashboardStats() {
            const totalRevenue = allOrders
                .filter(order => order.status === 'Delivered')
                .reduce((sum, order) => sum + order.total, 0);
            
            document.getElementById('total-revenue').textContent = `₹${totalRevenue.toFixed(2)}`;
            document.getElementById('total-orders').textContent = allOrders.length;
            document.getElementById('total-customers').textContent = allCustomers.length;
            
            updateRevenueChart();
        }

        function updateRevenueChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            const last7Days = Array(7).fill(0).map((_, i) => {
                const d = new Date();
                d.setDate(d.getDate() - i);
                return d.toISOString().split('T')[0];
            }).reverse();

            const revenueData = last7Days.map(dateStr => {
                return allOrders
                    .filter(order => order.status === 'Delivered' && order.orderDate.toDate().toISOString().split('T')[0] === dateStr)
                    .reduce((sum, order) => sum + order.total, 0);
            });
            
            const labels = last7Days.map(dateStr => new Date(dateStr).toLocaleDateString('en-IN', { month: 'short', day: 'numeric' }));

            if (revenueChartInstance) {
                revenueChartInstance.destroy();
            }

            revenueChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'Revenue',
                        data: revenueData,
                        borderColor: 'rgba(39, 174, 96, 1)',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        // --- Orders Table ---
        function renderOrdersTable(orders) {
            const head = document.getElementById('orders-table-head');
            const body = document.getElementById('orders-table-body');
            head.innerHTML = `<tr><th>Order ID</th><th>Customer</th><th>Date</th><th>Total</th><th>Status</th><th>Actions</th></tr>`;
            
            if (orders.length === 0) {
                body.innerHTML = `<tr class="empty-row"><td colspan="6">No orders found.</td></tr>`;
                return;
            }
            
            body.innerHTML = orders.map(order => `
                <tr>
                    <td><code>${order.paymentDetails.orderCode}</code></td>
                    <td class="customer-details">
                        ${order.customerInfo.name}
                        <small>${order.customerInfo.email}</small>
                    </td>
                    <td>${order.orderDate.toDate().toLocaleDateString('en-IN')}</td>
                    <td>₹${order.total.toFixed(2)}</td>
                    <td>
                        <select class="status-select" data-order-id="${order.id}">
                            <option value="Processing" ${order.status === 'Processing' ? 'selected' : ''}>Processing</option>
                            <option value="Shipped" ${order.status === 'Shipped' ? 'selected' : ''}>Shipped</option>
                            <option value="Delivered" ${order.status === 'Delivered' ? 'selected' : ''}>Delivered</option>
                            <option value="Cancelled" ${order.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                        </select>
                    </td>
                    <td class="actions-cell">
                        <button class="btn-primary view-order-btn" data-order-id="${order.id}">View</button>
                    </td>
                </tr>
            `).join('');
        }
        
        // --- Customers Table ---
        function renderCustomersTable(customers) {
            const head = document.getElementById('customers-table-head');
            const body = document.getElementById('customers-table-body');
            head.innerHTML = `<tr><th>Name</th><th>Email</th><th>Phone</th><th>Role</th></tr>`;
             if (customers.length === 0) {
                body.innerHTML = `<tr class="empty-row"><td colspan="4">No customers found.</td></tr>`;
                return;
            }
            body.innerHTML = customers.map(cust => `
                <tr>
                    <td>${cust.name || 'N/A'}</td>
                    <td>${cust.email}</td>
                    <td>${cust.phone || 'N/A'}</td>
                    <td><span class="status-badge status-${cust.role || 'user'}">${cust.role || 'user'}</span></td>
                </tr>
            `).join('');
        }

        // --- Search Functionality ---
        function setupSearch() {
            document.getElementById('order-search').addEventListener('input', debounce((e) => {
                const term = e.target.value.toLowerCase();
                const filtered = allOrders.filter(o => 
                    o.paymentDetails.orderCode.toLowerCase().includes(term) ||
                    o.customerInfo.name.toLowerCase().includes(term) ||
                    o.status.toLowerCase().includes(term)
                );
                renderOrdersTable(filtered);
            }, 300));

            document.getElementById('customer-search').addEventListener('input', debounce((e) => {
                const term = e.target.value.toLowerCase();
                const filtered = allCustomers.filter(c =>
                    (c.name && c.name.toLowerCase().includes(term)) ||
                    c.email.toLowerCase().includes(term) ||
                    (c.phone && c.phone.includes(term))
                );
                renderCustomersTable(filtered);
            }, 300));
        }

        // --- Event Delegation for Table Actions ---
        document.body.addEventListener('change', async (e) => {
            if (e.target.matches('.status-select')) {
                showLoader(true);
                const orderId = e.target.dataset.orderId;
                const newStatus = e.target.value;
                const orderRef = doc(db, 'orders', orderId);
                try {
                    await updateDoc(orderRef, { status: newStatus });
                    showToast(`Order status updated to ${newStatus}`);
                } catch (error) {
                    showToast('Failed to update status.', true);
                }
                showLoader(false);
            }
        });
        
        document.body.addEventListener('click', (e) => {
            if (e.target.matches('.view-order-btn')) {
                const order = allOrders.find(o => o.id === e.target.dataset.orderId);
                showOrderModal(order);
            }
            if(e.target.matches('.close-modal')) {
                e.target.closest('.modal-overlay').classList.remove('show');
            }
        });

        // --- Order Details Modal ---
        const orderDetailsModal = document.getElementById('orderDetailsModal');
        function showOrderModal(order) {
            document.getElementById('modalOrderId').textContent = order.paymentDetails.orderCode;
            document.getElementById('modalCustomerName').textContent = `${order.customerInfo.name} (${order.customerInfo.email})`;
            document.getElementById('modalCustomerAddress').textContent = order.shippingAddress.address;
            document.getElementById('modal-order-items').innerHTML = order.items.map(item => `<li><span>${item.name} (x${item.quantity})</span> <span>₹${(item.price * item.quantity).toFixed(2)}</span></li>`).join('');
            document.getElementById('modalOrderTotal').textContent = order.total.toFixed(2);
            orderDetailsModal.classList.add('show');
        }
    </script>
</body>
</html>
